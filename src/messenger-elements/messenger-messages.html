<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./messenger-message.html">

<dom-module id="messenger-messages">
  <style>
    :host {
      display: block;
      height: 50vh;
      overflow-y: scroll;
      background-color: white;
    }
  </style>

  <template>
    <template is="dom-repeat" id="messagesEl" items="{{messages}}" as="message">
      <messenger-message uid="{{uid}}" message="{{message}}"></messenger-message>
    </template>
  </template>

  <script>
    function scrollToBottom(e) {
      e.scrollTop = e.scrollHeight - e.getBoundingClientRect().height
    }
  </script>

  <script>
    Polymer({
      is: "messenger-messages",

      properties: {
        roomkey: String,
        messages: {
          type: Array,
          value: function () { return []; },
          uid: String
        }
      },

      listeners: {
        "added": "scroll"
      },

      attached: function () {
        this.dbRef = firebase.database().ref("/messages/" + this.roomkey)
        this.dbRef.on("child_added", (data) => this.newMessage(data))
      },

      newMessage: function (data) {
        this.push("messages", data.val())
      },

      scroll: function () {
        scrollToBottom(this)
      }
    })
  </script>
</dom-module>