<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-down-animation.html">
<link rel="import" href="../../bower_components/image-mask/image-mask.html">
<link rel="import" href="./messenger-settings-menu.html">
<link rel="import" href="./messenger-connected-users.html">

<dom-module id="messenger-home">
  <style>
    :host {
      display: none;
      width: 100%;
      text-align: center;
      position: relative;
    }
    header {
      background-color: var(--paper-indigo-200);
      padding: 1em;
    }

    messenger-settings-menu {
      position: absolute;
      top: 1em;
      right: 1em;
      color: white;
    }
  </style>

  <template>
    <header>
      <image-mask src="{{userData.photoURL}}" size="150"></image-mask>
      <messenger-settings-menu></messenger-settings-menu>
    </header>
    <messenger-connected-users currentuser="{{user}}"></messenger-connected-users>
  </template>

  <script>
    Polymer({
      is: "messenger-home",

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        opened: {
          type: Boolean,
          value: false
        },
        user: {
          type: Object,
          observer: "_userChanged"
        },
        animationConfig: {
          value: function () {
            return {
              "entry": [{
                name: "scale-up-animation",
                id: "scale-up-animation",
                node: this
              }],
              "exit": [{
                name: "scale-down-animation",
                node: this
              }]
            }
          }
        }
      },

      listeners: {
        "neon-animation-finish": "_animationFinished"
      },

      ready: function () {
        this.hide()
      },
      
      hide: function () {
        this.opened = false
        this.playAnimation("exit")
      },

      show: function () {
        this.opened = true
        this.style.display = "block"
        this.playAnimation("entry")
      },

      _animationFinished: function () {
        if (!this.opened) this.style.display = "none"
      },
      
      findUser: function () {
        var userRef = firebase.database().ref("/user/" + this.user.uid)

        userRef.on("value", (data) => {
          this.userData = data.val()
        })
      },

      _userChanged: function () {
        if (this.user !== null) this.findUser()
      }
    })
  </script>
</dom-module>